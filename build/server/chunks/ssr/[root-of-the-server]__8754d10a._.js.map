{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///home/mgrumadas/projects/match4paws/src/components/onboarding/OnboardingCheck.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRouter } from \"next/navigation\";\nimport { useEffect, useState, useCallback } from \"react\";\n\nexport default function OnboardingCheck({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const router = useRouter();\n  const [isReady, setIsReady] = useState(false);\n\n  const checkOnboardingStatus = useCallback(\n    async (userId: string) => {\n      try {\n        console.log(\"[OnboardingCheck] Checking or creating user:\", userId);\n\n        await fetch(\"/api/users/create\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ userId }),\n        });\n\n        const response = await fetch(\"/api/check-onboarding\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ userId }),\n        });\n\n        const data = await response.json();\n\n        if (!data.onboardingCompleted) {\n          console.log(\"[OnboardingCheck] Redirecting to /onboarding\");\n          router.push(\"/onboarding\");\n        } else {\n          console.log(\"[OnboardingCheck] Onboarding complete\");\n          setIsReady(true);\n        }\n      } catch (error) {\n        console.error(\"[OnboardingCheck] Failed:\", error);\n        setIsReady(true); // allow fallback render\n      }\n    },\n    [router]\n  );\n\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const response = await fetch(\"/auth/profile\");\n        const contentType = response.headers.get(\"content-type\");\n\n        if (!contentType?.includes(\"application/json\")) {\n          console.warn(\"[OnboardingCheck] Invalid content type:\", contentType);\n          setIsReady(true);\n          return;\n        }\n\n        if (response.ok) {\n          const user = await response.json();\n          console.log(\"[OnboardingCheck] User loaded:\", user?.sub);\n\n          if (user?.sub) {\n            checkOnboardingStatus(user.sub);\n          } else {\n            setIsReady(true);\n          }\n        } else {\n          console.warn(\"[OnboardingCheck] Failed to fetch user\");\n          setIsReady(true);\n        }\n      } catch (err) {\n        console.error(\"[OnboardingCheck] Error fetching user:\", err);\n        setIsReady(true);\n      }\n    };\n\n    fetchUser();\n  }, [checkOnboardingStatus]);\n\n  if (!isReady) return <div>Not working!</div>;\n\n  return <>{children}</>;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;;AAKe,SAAS,gBAAgB,EACtC,QAAQ,EAGT;IACC,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,MAAM,wBAAwB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EACtC,OAAO;QACL,IAAI;YACF,QAAQ,GAAG,CAAC,gDAAgD;YAE5D,MAAM,MAAM,qBAAqB;gBAC/B,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAO;YAChC;YAEA,MAAM,WAAW,MAAM,MAAM,yBAAyB;gBACpD,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAO;YAChC;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,IAAI,CAAC,KAAK,mBAAmB,EAAE;gBAC7B,QAAQ,GAAG,CAAC;gBACZ,OAAO,IAAI,CAAC;YACd,OAAO;gBACL,QAAQ,GAAG,CAAC;gBACZ,WAAW;YACb;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,WAAW,OAAO,wBAAwB;QAC5C;IACF,GACA;QAAC;KAAO;IAGV,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,YAAY;YAChB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM;gBAC7B,MAAM,cAAc,SAAS,OAAO,CAAC,GAAG,CAAC;gBAEzC,IAAI,CAAC,aAAa,SAAS,qBAAqB;oBAC9C,QAAQ,IAAI,CAAC,2CAA2C;oBACxD,WAAW;oBACX;gBACF;gBAEA,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,QAAQ,GAAG,CAAC,kCAAkC,MAAM;oBAEpD,IAAI,MAAM,KAAK;wBACb,sBAAsB,KAAK,GAAG;oBAChC,OAAO;wBACL,WAAW;oBACb;gBACF,OAAO;oBACL,QAAQ,IAAI,CAAC;oBACb,WAAW;gBACb;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,0CAA0C;gBACxD,WAAW;YACb;QACF;QAEA;IACF,GAAG;QAAC;KAAsB;IAE1B,IAAI,CAAC,SAAS,qBAAO,8OAAC;kBAAI;;;;;;IAE1B,qBAAO;kBAAG;;AACZ","debugId":null}}]
}