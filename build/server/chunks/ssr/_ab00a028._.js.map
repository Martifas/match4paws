{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/hooks/useMessages.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\n\nexport type Message = {\n  id: string;\n  conversation_id: string;\n  senderId: string;\n  body: string;\n  sentAt: string;\n  readAt: string | null;\n};\n\n\n\nexport default function useMessages(conversationId?: string, pollMs = 8_000) {\n  const [msgs, setMsgs] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(Boolean(conversationId));\n  const [error, setError] = useState<string | null>(null);\n\n  const latest = useRef<string | null>(null);\n\n  const fetchNew = useCallback(async () => {\n    if (!conversationId) return;\n\n    try {\n      const url = new URL('/api/messages', location.origin);\n      url.searchParams.set('conversationId', conversationId);\n      if (latest.current) url.searchParams.set('after', latest.current);\n\n      const res = await fetch(url.toString());\n      const { messages = [] } = await res.json();\n\n      if (messages.length) {\n        setMsgs(prev => {\n          const seen = new Set(prev.map(m => m.id));\n          const unique = messages.filter((m: Message) => !seen.has(m.id));\n          return unique.length ? [...prev, ...unique] : prev;\n        });\n        latest.current = messages.at(-1).sent_at;\n      }\n\n      setError(null);\n    } catch {\n      setError('Failed to load messages');\n    } finally {\n      setLoading(false);\n    }\n  }, [conversationId]);\n\n  useEffect(() => {\n    if (!conversationId) return;\n    setMsgs([]);\n    latest.current = null;\n    setLoading(true);\n    fetchNew();\n    const id = setInterval(fetchNew, pollMs);\n    return () => clearInterval(id);\n  }, [conversationId, fetchNew, pollMs]);\n\n  const send = useCallback(\n    async (body: string, senderId: string) => {\n      const temp: Message = {\n        id: crypto.randomUUID(),\n        conversation_id: conversationId!,\n        senderId: senderId,\n        body,\n        sentAt: new Date().toISOString(),\n        readAt: null,\n      };\n      setMsgs(prev => [...prev, temp]);\n\n      try {\n        const res = await fetch('/api/messages', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ conversationId, body }),\n        });\n        const { message } = await res.json();\n\n        setMsgs(prev => prev.map(m => (m.id === temp.id ? message : m)));\n        latest.current = message.sent_at;\n      } catch {\n        setMsgs(prev => prev.filter(m => m.id !== temp.id));\n        throw new Error('send-failed');\n      }\n    },\n    [conversationId]\n  );\n\n  return { messages: msgs, loading, error, send, refresh: fetchNew };\n}\n"],"names":[],"mappings":";;;AAEA;AAFA;;AAee,SAAS,YAAY,cAAuB,EAAE,SAAS,KAAK;IACzE,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAa,EAAE;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,QAAQ;IAC/C,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAElD,MAAM,SAAS,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAiB;IAErC,MAAM,WAAW,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAC3B,IAAI,CAAC,gBAAgB;QAErB,IAAI;YACF,MAAM,MAAM,IAAI,IAAI,iBAAiB,SAAS,MAAM;YACpD,IAAI,YAAY,CAAC,GAAG,CAAC,kBAAkB;YACvC,IAAI,OAAO,OAAO,EAAE,IAAI,YAAY,CAAC,GAAG,CAAC,SAAS,OAAO,OAAO;YAEhE,MAAM,MAAM,MAAM,MAAM,IAAI,QAAQ;YACpC,MAAM,EAAE,WAAW,EAAE,EAAE,GAAG,MAAM,IAAI,IAAI;YAExC,IAAI,SAAS,MAAM,EAAE;gBACnB,QAAQ,CAAA;oBACN,MAAM,OAAO,IAAI,IAAI,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,EAAE;oBACvC,MAAM,SAAS,SAAS,MAAM,CAAC,CAAC,IAAe,CAAC,KAAK,GAAG,CAAC,EAAE,EAAE;oBAC7D,OAAO,OAAO,MAAM,GAAG;2BAAI;2BAAS;qBAAO,GAAG;gBAChD;gBACA,OAAO,OAAO,GAAG,SAAS,EAAE,CAAC,CAAC,GAAG,OAAO;YAC1C;YAEA,SAAS;QACX,EAAE,OAAM;YACN,SAAS;QACX,SAAU;YACR,WAAW;QACb;IACF,GAAG;QAAC;KAAe;IAEnB,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,CAAC,gBAAgB;QACrB,QAAQ,EAAE;QACV,OAAO,OAAO,GAAG;QACjB,WAAW;QACX;QACA,MAAM,KAAK,YAAY,UAAU;QACjC,OAAO,IAAM,cAAc;IAC7B,GAAG;QAAC;QAAgB;QAAU;KAAO;IAErC,MAAM,OAAO,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EACrB,OAAO,MAAc;QACnB,MAAM,OAAgB;YACpB,IAAI,OAAO,UAAU;YACrB,iBAAiB;YACjB,UAAU;YACV;YACA,QAAQ,IAAI,OAAO,WAAW;YAC9B,QAAQ;QACV;QACA,QAAQ,CAAA,OAAQ;mBAAI;gBAAM;aAAK;QAE/B,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,iBAAiB;gBACvC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;oBAAgB;gBAAK;YAC9C;YACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;YAElC,QAAQ,CAAA,OAAQ,KAAK,GAAG,CAAC,CAAA,IAAM,EAAE,EAAE,KAAK,KAAK,EAAE,GAAG,UAAU;YAC5D,OAAO,OAAO,GAAG,QAAQ,OAAO;QAClC,EAAE,OAAM;YACN,QAAQ,CAAA,OAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,EAAE;YACjD,MAAM,IAAI,MAAM;QAClB;IACF,GACA;QAAC;KAAe;IAGlB,OAAO;QAAE,UAAU;QAAM;QAAS;QAAO;QAAM,SAAS;IAAS;AACnE","debugId":null}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/hooks/useUserProfile.ts"],"sourcesContent":["import { useAuth } from '@/lib/authProvider';\nimport { User } from '@/lib/queries/users';\nimport { useEffect, useState } from 'react';\n\nexport default function useUserProfile() {\n  const authUser = useAuth();\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchUserData = async () => {\n      if (!authUser?.id) {\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        const response = await fetch('/api/user/profile');\n        if (response.ok) {\n          const userData = await response.json();\n          setUser(userData.user);\n        }\n      } catch (error) {\n        console.error('Error fetching user data:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchUserData();\n  }, [authUser?.id]);\n\n  return { user, isLoading };\n}\n"],"names":[],"mappings":";;;AAAA;AAEA;;;AAEe,SAAS;IACtB,MAAM,WAAW,CAAA,GAAA,2HAAA,CAAA,UAAO,AAAD;IACvB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE3C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,gBAAgB;YACpB,IAAI,CAAC,UAAU,IAAI;gBACjB,aAAa;gBACb;YACF;YAEA,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,WAAW,MAAM,SAAS,IAAI;oBACpC,QAAQ,SAAS,IAAI;gBACvB;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,6BAA6B;YAC7C,SAAU;gBACR,aAAa;YACf;QACF;QAEA;IACF,GAAG;QAAC,UAAU;KAAG;IAEjB,OAAO;QAAE;QAAM;IAAU;AAC3B","debugId":null}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/components/chat/ChatWindow.tsx"],"sourcesContent":["'use client';\n\nimport { useRef, useEffect, useState } from 'react';\nimport useMessages from '@/hooks/useMessages';\nimport useUserProfile from '@/hooks/useUserProfile';\n\nexport default function ChatWindow({\n  conversationId,\n  \n}: {\n  conversationId?: string;\n}) {\n  const { user, isLoading: userLoading } = useUserProfile();\n  const { messages, send, loading, error } = useMessages(conversationId);\n  const [draft, setDraft] = useState('');\n  const bottomRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const submit = async () => {\n    if (!draft.trim() || !user || !conversationId) return;\n    await send(draft.trim(), user.id);\n    setDraft('');\n  };\n\n  if (!conversationId)\n    return (\n      <p className=\"text-center py-10 text-gray-500\">\n        Select a conversation to start chatting.\n      </p>\n    );\n\n  if (userLoading || loading)\n    return <p className=\"text-center py-10\">Loading…</p>;\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {error && <p className=\"text-red-500\">{error}</p>}\n\n        {messages.map(m => {\n          const mine = m.senderId === user.id;\n\n          return (\n            <div\n              key={m.id}\n              className={`max-w-xs p-3 rounded-lg ${\n                mine\n                  ? 'ml-auto bg-orange-100 text-gray-900'\n                  : 'mr-auto bg-gray-100 text-gray-800'\n              }`}\n            >\n              <Avatar\n                sx={{\n                  width: '12px',\n                  height: '12px',\n                  mx: 'auto',\n                  mb: 2,\n                  bgcolor: '#ed9426',\n                  fontSize: `${avatarSize / 40}rem`,\n                }}\n              >\n                {user.name?.charAt(0)?.toUpperCase() || 'U'}\n              </Avatar>\n              {m.body}\n            </div>\n          );\n        })}\n        <div ref={bottomRef} />\n      </div>\n\n      <div className=\"p-3 pb-20 border-t flex gap-2\">\n        <input\n          className=\"flex-1 border rounded px-3 py-2\"\n          value={draft}\n          onChange={e => setDraft(e.target.value)}\n          onKeyDown={e => e.key === 'Enter' && submit()}\n          placeholder=\"Type a message…\"\n        />\n        <button\n          className=\"bg-orange-500 text-white rounded px-4 disabled:opacity-50\"\n          onClick={submit}\n          disabled={!draft.trim()}\n        >\n          Send\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,WAAW,EACjC,cAAc,EAIf;IACC,MAAM,EAAE,IAAI,EAAE,WAAW,WAAW,EAAE,GAAG,CAAA,GAAA,8HAAA,CAAA,UAAc,AAAD;IACtD,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,2HAAA,CAAA,UAAW,AAAD,EAAE;IACvD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,YAAY,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAkB;IAEzC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,UAAU,OAAO,EAAE,eAAe;YAAE,UAAU;QAAS;IACzD,GAAG;QAAC;KAAS;IAEb,MAAM,SAAS;QACb,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,gBAAgB;QAC/C,MAAM,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;QAChC,SAAS;IACX;IAEA,IAAI,CAAC,gBACH,qBACE,8OAAC;QAAE,WAAU;kBAAkC;;;;;;IAKnD,IAAI,eAAe,SACjB,qBAAO,8OAAC;QAAE,WAAU;kBAAoB;;;;;;IAE1C,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;oBACZ,uBAAS,8OAAC;wBAAE,WAAU;kCAAgB;;;;;;oBAEtC,SAAS,GAAG,CAAC,CAAA;wBACZ,MAAM,OAAO,EAAE,QAAQ,KAAK,KAAK,EAAE;wBAEnC,qBACE,8OAAC;4BAEC,WAAW,CAAC,wBAAwB,EAClC,OACI,wCACA,qCACJ;;8CAEF,8OAAC;oCACC,IAAI;wCACF,OAAO;wCACP,QAAQ;wCACR,IAAI;wCACJ,IAAI;wCACJ,SAAS;wCACT,UAAU,GAAG,aAAa,GAAG,GAAG,CAAC;oCACnC;8CAEC,KAAK,IAAI,EAAE,OAAO,IAAI,iBAAiB;;;;;;gCAEzC,EAAE,IAAI;;2BAnBF,EAAE,EAAE;;;;;oBAsBf;kCACA,8OAAC;wBAAI,KAAK;;;;;;;;;;;;0BAGZ,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,WAAU;wBACV,OAAO;wBACP,UAAU,CAAA,IAAK,SAAS,EAAE,MAAM,CAAC,KAAK;wBACtC,WAAW,CAAA,IAAK,EAAE,GAAG,KAAK,WAAW;wBACrC,aAAY;;;;;;kCAEd,8OAAC;wBACC,WAAU;wBACV,SAAS;wBACT,UAAU,CAAC,MAAM,IAAI;kCACtB;;;;;;;;;;;;;;;;;;AAMT","debugId":null}},
    {"offset": {"line": 294, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/components/ui/buttons/BackButton.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRouter, usePathname } from \"next/navigation\";\nimport ArrowBackIcon from \"@mui/icons-material/ArrowBack\";\nimport clsx from \"clsx\";\nimport { ComponentPropsWithoutRef } from \"react\";\n\ntype BackButtonProps = {\n  to?: string;\n  hidden?: boolean;\n  className?: string;\n  onClick?: () => void;\n  smartNavigation?: boolean;\n} & Omit<ComponentPropsWithoutRef<\"button\">, \"children\" | \"onClick\">;\n\nexport default function BackButton({\n  to,\n  hidden,\n  className,\n  onClick,\n  smartNavigation = false,\n  ...buttonProps\n}: BackButtonProps) {\n  const router = useRouter();\n  const pathname = usePathname();\n\n  if (hidden) return null;\n\n  const handleClick = () => {\n    if (onClick) {\n      onClick();\n    } else if (to) {\n      router.push(to);\n    } else if (smartNavigation) {\n      const referrer = document.referrer;\n\n      if (referrer.includes(\"/favorites\") || pathname.startsWith(\"/pet/\")) {\n        router.push(\"/favorites?refresh=\" + Date.now());\n      } else {\n        router.back();\n      }\n    } else {\n      router.back();\n    }\n  };\n\n  return (\n    <button\n      type=\"button\"\n      onClick={handleClick}\n      className={clsx(\n        \"text-[#ed9426] hover:text-orange-300 hover:scale-110 font-bold\",\n        className\n      )}\n      {...buttonProps}\n    >\n      <ArrowBackIcon fontSize=\"large\" />\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAee,SAAS,WAAW,EACjC,EAAE,EACF,MAAM,EACN,SAAS,EACT,OAAO,EACP,kBAAkB,KAAK,EACvB,GAAG,aACa;IAChB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,WAAW,CAAA,GAAA,kIAAA,CAAA,cAAW,AAAD;IAE3B,IAAI,QAAQ,OAAO;IAEnB,MAAM,cAAc;QAClB,IAAI,SAAS;YACX;QACF,OAAO,IAAI,IAAI;YACb,OAAO,IAAI,CAAC;QACd,OAAO,IAAI,iBAAiB;YAC1B,MAAM,WAAW,SAAS,QAAQ;YAElC,IAAI,SAAS,QAAQ,CAAC,iBAAiB,SAAS,UAAU,CAAC,UAAU;gBACnE,OAAO,IAAI,CAAC,wBAAwB,KAAK,GAAG;YAC9C,OAAO;gBACL,OAAO,IAAI;YACb;QACF,OAAO;YACL,OAAO,IAAI;QACb;IACF;IAEA,qBACE,8OAAC;QACC,MAAK;QACL,SAAS;QACT,WAAW,CAAA,GAAA,qIAAA,CAAA,UAAI,AAAD,EACZ,kEACA;QAED,GAAG,WAAW;kBAEf,cAAA,8OAAC,8JAAA,CAAA,UAAa;YAAC,UAAS;;;;;;;;;;;AAG9B","debugId":null}},
    {"offset": {"line": 350, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/components/ui/containers/Header.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\n\nexport default function Header({\n  left,\n  center,\n  right,\n  children,\n}: {\n  left?: React.ReactNode;\n  center?: React.ReactNode;\n  right?: React.ReactNode;\n  children?: React.ReactNode;\n}) {\n  return (\n    <header className=\"w-full max-w-md mx-auto  md:max-w-xl py-2 flex items-center justify-between gap-4\">\n      {children ? (\n        children\n      ) : (\n        <>\n          <div className=\"flex-shrink-0\">{left}</div>\n          <div className=\"flex-1 text-center overflow-hidden\">{center}</div>\n          <div className=\"flex-shrink-0\">{right}</div>\n        </>\n      )}\n    </header>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;;AAIe,SAAS,OAAO,EAC7B,IAAI,EACJ,MAAM,EACN,KAAK,EACL,QAAQ,EAMT;IACC,qBACE,8OAAC;QAAO,WAAU;kBACf,WACC,yBAEA;;8BACE,8OAAC;oBAAI,WAAU;8BAAiB;;;;;;8BAChC,8OAAC;oBAAI,WAAU;8BAAsC;;;;;;8BACrD,8OAAC;oBAAI,WAAU;8BAAiB;;;;;;;;;;;;;AAK1C","debugId":null}},
    {"offset": {"line": 399, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/node_modules/%40mui/icons-material/esm/ArrowBack.js"],"sourcesContent":["\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z\"\n}), 'ArrowBack');"],"names":[],"mappings":";;;AAEA;AACA;AAHA;;;uCAIe,CAAA,GAAA,kKAAA,CAAA,UAAa,AAAD,EAAE,WAAW,GAAE,CAAA,GAAA,uNAAA,CAAA,MAAI,AAAD,EAAE,QAAQ;IACrD,GAAG;AACL,IAAI","ignoreList":[0],"debugId":null}}]
}