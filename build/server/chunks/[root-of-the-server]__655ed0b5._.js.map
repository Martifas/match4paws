{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/lib/auth0.ts"],"sourcesContent":["import { Auth0Client } from '@auth0/nextjs-auth0/server';\n\nexport const auth0 = new Auth0Client({\n  domain: process.env.AUTH0_DOMAIN,\n  clientId: process.env.AUTH0_CLIENT_ID,\n  clientSecret: process.env.AUTH0_CLIENT_SECRET,\n  secret: process.env.AUTH0_SECRET,\n  appBaseUrl: process.env.APP_BASE_URL,\n});\n"],"names":[],"mappings":";;;AAAA;AAAA;;AAEO,MAAM,QAAQ,IAAI,wKAAA,CAAA,cAAW,CAAC;IACnC,QAAQ,QAAQ,GAAG,CAAC,YAAY;IAChC,UAAU,QAAQ,GAAG,CAAC,eAAe;IACrC,cAAc,QAAQ,GAAG,CAAC,mBAAmB;IAC7C,QAAQ,QAAQ,GAAG,CAAC,YAAY;IAChC,YAAY,QAAQ,GAAG,CAAC,YAAY;AACtC","debugId":null}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/lib/db.ts"],"sourcesContent":["import \"dotenv/config\";\nimport { Kysely, PostgresDialect, CamelCasePlugin } from \"kysely\";\nimport { Pool } from \"pg\";\nimport { DB } from \"@/database/types\";\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nconst dialect = new PostgresDialect({ pool });\n\nexport const db = new Kysely<DB>({\n  dialect,\n  plugins: [new CamelCasePlugin()],\n});\n"],"names":[],"mappings":";;;AAAA;AACA;AAAA;AAAA;AACA;;;;;;;;AAGA,MAAM,OAAO,IAAI,oGAAA,CAAA,OAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEA,MAAM,UAAU,IAAI,qLAAA,CAAA,kBAAe,CAAC;IAAE;AAAK;AAEpC,MAAM,KAAK,IAAI,iJAAA,CAAA,SAAM,CAAK;IAC/B;IACA,SAAS;QAAC,IAAI,6LAAA,CAAA,kBAAe;KAAG;AAClC","debugId":null}},
    {"offset": {"line": 215, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/lib/queries/users.ts"],"sourcesContent":["import { db } from '@/lib/db';\nimport { UpdateOnboardingRequest } from '@/lib/types/onboarding';\n\nexport type User = {\n  id: string;\n  auth0Id: string;\n  name?: string;\n  email?: string;\n  phone?: string;\n  userType?: string;\n  onboardingCompleted: boolean;\n  createdAt: Date;\n  lastLoginAt?: Date;\n  address: string;\n};\n\nexport async function getUserByAuth0Id(\n  auth0Id: string\n): Promise<{ id: string } | null> {\n  return (\n    (await db\n      .selectFrom('users')\n      .select(['id'])\n      .where('auth0Id', '=', auth0Id)\n      .executeTakeFirst()) || null\n  );\n}\n\nexport async function getUserById(id: string): Promise<User | null> {\n  return (\n    (await db\n      .selectFrom('users')\n      .selectAll()\n      .where('id', '=', id)\n      .executeTakeFirst()) || null\n  );\n}\n\nexport async function createUser(auth0Id: string): Promise<void> {\n  await db\n    .insertInto('users')\n    .values({ auth0Id })\n    .onConflict(oc => oc.column('auth0Id').doNothing())\n    .execute();\n}\n\nexport async function updateLastLogin(auth0Id: string): Promise<void> {\n  await db\n    .updateTable('users')\n    .set({ lastLoginAt: new Date() })\n    .where('auth0Id', '=', auth0Id)\n    .execute();\n}\n\nexport async function getUserOnboardingStatus(\n  auth0Id: string\n): Promise<boolean> {\n  const result = await db\n    .selectFrom('users')\n    .select(['onboardingCompleted'])\n    .where('auth0Id', '=', auth0Id)\n    .executeTakeFirst();\n\n  return result?.onboardingCompleted ?? false;\n}\n\nexport async function updateUserOnboarding(\n  data: UpdateOnboardingRequest\n): Promise<void> {\n  const { userId, ...updateData } = data;\n\n  await db\n    .updateTable('users')\n    .set({\n      onboardingCompleted: true,\n      onboardingCompletedAt: new Date(),\n      ...updateData,\n    })\n    .where('auth0Id', '=', userId)\n    .execute();\n}\n\nexport async function updateUserProfile(\n  userId: string,\n  updates: Partial<Pick<User, 'name' | 'email' | 'phone' | 'address'>>\n) {\n  if (!Object.keys(updates).length) return;\n  await db\n    .updateTable('users')\n    .set({ ...updates })\n    .where('id', '=', userId)\n    .execute();\n}\n"],"names":[],"mappings":";;;;;;;;;AAAA;;;;;;AAgBO,eAAe,iBACpB,OAAe;IAEf,OACE,AAAC,MAAM,kHAAA,CAAA,KAAE,CACN,UAAU,CAAC,SACX,MAAM,CAAC;QAAC;KAAK,EACb,KAAK,CAAC,WAAW,KAAK,SACtB,gBAAgB,MAAO;AAE9B;AAEO,eAAe,YAAY,EAAU;IAC1C,OACE,AAAC,MAAM,kHAAA,CAAA,KAAE,CACN,UAAU,CAAC,SACX,SAAS,GACT,KAAK,CAAC,MAAM,KAAK,IACjB,gBAAgB,MAAO;AAE9B;AAEO,eAAe,WAAW,OAAe;IAC9C,MAAM,kHAAA,CAAA,KAAE,CACL,UAAU,CAAC,SACX,MAAM,CAAC;QAAE;IAAQ,GACjB,UAAU,CAAC,CAAA,KAAM,GAAG,MAAM,CAAC,WAAW,SAAS,IAC/C,OAAO;AACZ;AAEO,eAAe,gBAAgB,OAAe;IACnD,MAAM,kHAAA,CAAA,KAAE,CACL,WAAW,CAAC,SACZ,GAAG,CAAC;QAAE,aAAa,IAAI;IAAO,GAC9B,KAAK,CAAC,WAAW,KAAK,SACtB,OAAO;AACZ;AAEO,eAAe,wBACpB,OAAe;IAEf,MAAM,SAAS,MAAM,kHAAA,CAAA,KAAE,CACpB,UAAU,CAAC,SACX,MAAM,CAAC;QAAC;KAAsB,EAC9B,KAAK,CAAC,WAAW,KAAK,SACtB,gBAAgB;IAEnB,OAAO,QAAQ,uBAAuB;AACxC;AAEO,eAAe,qBACpB,IAA6B;IAE7B,MAAM,EAAE,MAAM,EAAE,GAAG,YAAY,GAAG;IAElC,MAAM,kHAAA,CAAA,KAAE,CACL,WAAW,CAAC,SACZ,GAAG,CAAC;QACH,qBAAqB;QACrB,uBAAuB,IAAI;QAC3B,GAAG,UAAU;IACf,GACC,KAAK,CAAC,WAAW,KAAK,QACtB,OAAO;AACZ;AAEO,eAAe,kBACpB,MAAc,EACd,OAAoE;IAEpE,IAAI,CAAC,OAAO,IAAI,CAAC,SAAS,MAAM,EAAE;IAClC,MAAM,kHAAA,CAAA,KAAE,CACL,WAAW,CAAC,SACZ,GAAG,CAAC;QAAE,GAAG,OAAO;IAAC,GACjB,KAAK,CAAC,MAAM,KAAK,QACjB,OAAO;AACZ","debugId":null}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/lib/utils/apiUtils.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth0 } from \"@/lib/auth0\";\nimport { getUserByAuth0Id } from \"@/lib/queries/users\";\n\nexport async function getUserFromSession(\n  req?: NextRequest\n): Promise<string | null> {\n  const session = await auth0.getSession();\n\n  if (!session?.user?.sub) {\n    return null;\n  }\n\n  const user = await getUserByAuth0Id(session.user.sub);\n  return user?.id ?? null;\n}\n\nexport function createErrorResponse(message: string, status: number) {\n  return NextResponse.json({ error: message }, { status });\n}\n\nexport function createSuccessResponse(data?: any) {\n  return NextResponse.json({ success: true, ...data });\n}\n\nexport async function validateJsonBody<T>(\n  req: NextRequest,\n  requiredFields: (keyof T)[]\n): Promise<T | NextResponse> {\n  try {\n    const body = (await req.json()) as T;\n\n    for (const field of requiredFields) {\n      if (!body[field]) {\n        return createErrorResponse(\n          `Missing required field: ${String(field)}`,\n          400\n        );\n      }\n    }\n\n    return body;\n  } catch (error) {\n    return createErrorResponse(\"Invalid JSON body\", 400);\n  }\n}\n"],"names":[],"mappings":"AAAA,oDAAoD,GACpD,qDAAqD;;;;;;AACrD;AACA;AACA;;;;;;;;AAEO,eAAe,mBACpB,GAAiB;IAEjB,MAAM,UAAU,MAAM,qHAAA,CAAA,QAAK,CAAC,UAAU;IAEtC,IAAI,CAAC,SAAS,MAAM,KAAK;QACvB,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,CAAA,GAAA,gIAAA,CAAA,mBAAgB,AAAD,EAAE,QAAQ,IAAI,CAAC,GAAG;IACpD,OAAO,MAAM,MAAM;AACrB;AAEO,SAAS,oBAAoB,OAAe,EAAE,MAAc;IACjE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxD;AAEO,SAAS,sBAAsB,IAAU;IAC9C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAM,GAAG,IAAI;IAAC;AACpD;AAEO,eAAe,iBACpB,GAAgB,EAChB,cAA2B;IAE3B,IAAI;QACF,MAAM,OAAQ,MAAM,IAAI,IAAI;QAE5B,KAAK,MAAM,SAAS,eAAgB;YAClC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAChB,OAAO,oBACL,CAAC,wBAAwB,EAAE,OAAO,QAAQ,EAC1C;YAEJ;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO,oBAAoB,qBAAqB;IAClD;AACF","debugId":null}},
    {"offset": {"line": 332, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/lib/queries/conversations.ts"],"sourcesContent":["import { db } from '@/lib/db';\nimport { sql } from 'kysely';\n\nexport async function listConversationsForUser(userId: string) {\n  return db\n    .selectFrom('conversations as c')\n\n    .leftJoin('petImages as pi', join =>\n      join.onRef('pi.petId', '=', 'c.petId').on('pi.orderIdx', '=', 0)\n    )\n\n    .leftJoin('messages as m', 'm.conversationId', 'c.id')\n    .select([\n      'c.id',\n      'c.petId',\n      'c.adopterId',\n      'c.ownerId',\n      'c.createdAt',\n      'pi.url as thumbUrl',\n\n      sql<number>`count(*) filter (\n        where m.read_at is null\n          and m.sender_id <> ${userId}\n      )`.as('unread'),\n\n      sql<Date>`max(m.sent_at)`.as('lastSentAt'),\n      sql<string>`max(m.body)`.as('lastBody'),\n    ])\n\n    .where(eb =>\n      eb.or([eb('c.adopterId', '=', userId), eb('c.ownerId', '=', userId)])\n    )\n\n    .groupBy([\n      'c.id',\n      'c.petId',\n      'c.adopterId',\n      'c.ownerId',\n      'c.createdAt',\n      'pi.url',\n    ])\n\n    .orderBy(sql`max(m.sent_at)`, 'desc')\n    .execute();\n}\n\nexport async function getOrCreateConversation(\n  petId: string,\n  adopterId: string,\n  ownerId: string\n) {\n  const existing = await db\n    .selectFrom('conversations')\n    .select('id')\n    .where('petId', '=', petId)\n    .where('adopterId', '=', adopterId)\n    .where('ownerId', '=', ownerId)\n    .executeTakeFirst();\n\n  if (existing) return existing.id;\n\n  const { id } = await db\n    .insertInto('conversations')\n    .values({ petId: petId, adopterId: adopterId, ownerId: ownerId })\n    .returning('id')\n    .executeTakeFirstOrThrow();\n\n  return id;\n}\n\nexport async function deleteConversation(id: string) {\n  await db.transaction().execute(async trx => {\n    await trx.deleteFrom('messages').where('conversationId', '=', id).execute();\n    await trx.deleteFrom('conversations').where('id', '=', id).execute();\n  });\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;;;AAEO,eAAe,yBAAyB,MAAc;IAC3D,OAAO,kHAAA,CAAA,KAAE,CACN,UAAU,CAAC,sBAEX,QAAQ,CAAC,mBAAmB,CAAA,OAC3B,KAAK,KAAK,CAAC,YAAY,KAAK,WAAW,EAAE,CAAC,eAAe,KAAK,IAG/D,QAAQ,CAAC,iBAAiB,oBAAoB,QAC9C,MAAM,CAAC;QACN;QACA;QACA;QACA;QACA;QACA;QAEA,gKAAA,CAAA,MAAG,AAAQ,CAAC;;6BAEW,EAAE,OAAO;OAC/B,CAAC,CAAC,EAAE,CAAC;QAEN,gKAAA,CAAA,MAAG,AAAM,CAAC,cAAc,CAAC,CAAC,EAAE,CAAC;QAC7B,gKAAA,CAAA,MAAG,AAAQ,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC;KAC7B,EAEA,KAAK,CAAC,CAAA,KACL,GAAG,EAAE,CAAC;YAAC,GAAG,eAAe,KAAK;YAAS,GAAG,aAAa,KAAK;SAAQ,GAGrE,OAAO,CAAC;QACP;QACA;QACA;QACA;QACA;QACA;KACD,EAEA,OAAO,CAAC,gKAAA,CAAA,MAAG,CAAC,cAAc,CAAC,EAAE,QAC7B,OAAO;AACZ;AAEO,eAAe,wBACpB,KAAa,EACb,SAAiB,EACjB,OAAe;IAEf,MAAM,WAAW,MAAM,kHAAA,CAAA,KAAE,CACtB,UAAU,CAAC,iBACX,MAAM,CAAC,MACP,KAAK,CAAC,SAAS,KAAK,OACpB,KAAK,CAAC,aAAa,KAAK,WACxB,KAAK,CAAC,WAAW,KAAK,SACtB,gBAAgB;IAEnB,IAAI,UAAU,OAAO,SAAS,EAAE;IAEhC,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,kHAAA,CAAA,KAAE,CACpB,UAAU,CAAC,iBACX,MAAM,CAAC;QAAE,OAAO;QAAO,WAAW;QAAW,SAAS;IAAQ,GAC9D,SAAS,CAAC,MACV,uBAAuB;IAE1B,OAAO;AACT;AAEO,eAAe,mBAAmB,EAAU;IACjD,MAAM,kHAAA,CAAA,KAAE,CAAC,WAAW,GAAG,OAAO,CAAC,OAAM;QACnC,MAAM,IAAI,UAAU,CAAC,YAAY,KAAK,CAAC,kBAAkB,KAAK,IAAI,OAAO;QACzE,MAAM,IAAI,UAAU,CAAC,iBAAiB,KAAK,CAAC,MAAM,KAAK,IAAI,OAAO;IACpE;AACF","debugId":null}},
    {"offset": {"line": 394, "column": 0}, "map": {"version":3,"sources":["file:///home/marty/turing/4-module/4-sprint/match4paws/src/app/api/conversations/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport {\n  createErrorResponse,\n  createSuccessResponse,\n  getUserFromSession,\n} from '@/lib/utils/apiUtils';\nimport { deleteConversation } from '@/lib/queries/conversations';\nimport { db } from '@/lib/db';\n\ntype Params = { params: { id: string } };\n\nexport async function DELETE(req: NextRequest, { params }: Params) {\n  try {\n    const userId = await getUserFromSession();\n    if (!userId) return createErrorResponse('Unauthorized', 401);\n\n    const row = await db\n      .selectFrom('conversations')\n      .select('id')\n      .where('id', '=', params.id)\n      .where(eb =>\n        eb.or([eb('adopterId', '=', userId), eb('ownerId', '=', userId)])\n      )\n      .executeTakeFirst();\n\n    if (!row) return createErrorResponse('Not found', 404);\n\n    await deleteConversation(params.id);\n    return createSuccessResponse({});\n  } catch (e) {\n    console.error('DELETE /api/conversations/[id]', e);\n    return createErrorResponse('Internal server error', 500);\n  }\n}\n"],"names":[],"mappings":";;;AACA;AAKA;AACA;;;;;;;;;;AAIO,eAAe,OAAO,GAAgB,EAAE,EAAE,MAAM,EAAU;IAC/D,IAAI;QACF,MAAM,SAAS,MAAM,CAAA,GAAA,iIAAA,CAAA,qBAAkB,AAAD;QACtC,IAAI,CAAC,QAAQ,OAAO,CAAA,GAAA,iIAAA,CAAA,sBAAmB,AAAD,EAAE,gBAAgB;QAExD,MAAM,MAAM,MAAM,kHAAA,CAAA,KAAE,CACjB,UAAU,CAAC,iBACX,MAAM,CAAC,MACP,KAAK,CAAC,MAAM,KAAK,OAAO,EAAE,EAC1B,KAAK,CAAC,CAAA,KACL,GAAG,EAAE,CAAC;gBAAC,GAAG,aAAa,KAAK;gBAAS,GAAG,WAAW,KAAK;aAAQ,GAEjE,gBAAgB;QAEnB,IAAI,CAAC,KAAK,OAAO,CAAA,GAAA,iIAAA,CAAA,sBAAmB,AAAD,EAAE,aAAa;QAElD,MAAM,CAAA,GAAA,wIAAA,CAAA,qBAAkB,AAAD,EAAE,OAAO,EAAE;QAClC,OAAO,CAAA,GAAA,iIAAA,CAAA,wBAAqB,AAAD,EAAE,CAAC;IAChC,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,CAAA,GAAA,iIAAA,CAAA,sBAAmB,AAAD,EAAE,yBAAyB;IACtD;AACF","debugId":null}}]
}