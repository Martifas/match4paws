(()=>{var e={};e.id=287,e.ids=[287],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},5069:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{db:()=>p}),r(95710);var a=r(98614),n=r(40586),i=r(30650),c=r(64939),u=e([c]);let o=new(c=(u.then?(await u)():u)[0]).Pool({connectionString:process.env.DATABASE_URL}),d=new a.a({pool:o}),p=new n._$({dialect:d,plugins:[new i.E]});s()}catch(e){s(e)}})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21820:e=>{"use strict";e.exports=require("os")},24476:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{bx:()=>o,ce:()=>p,d$:()=>d,eg:()=>l,iU:()=>i,kg:()=>u,kl:()=>c});var a=r(5069),n=e([a]);async function i(e){return await a.db.selectFrom("users").select(["id"]).where("auth0Id","=",e).executeTakeFirst()||null}async function c(e){return await a.db.selectFrom("users").selectAll().where("id","=",e).executeTakeFirst()||null}async function u(e){await a.db.insertInto("users").values({auth0Id:e}).onConflict(e=>e.column("auth0Id").doNothing()).execute()}async function o(e){await a.db.updateTable("users").set({lastLoginAt:new Date}).where("auth0Id","=",e).execute()}async function d(e){let t=await a.db.selectFrom("users").select(["onboardingCompleted"]).where("auth0Id","=",e).executeTakeFirst();return t?.onboardingCompleted??!1}async function p(e){let{userId:t,...r}=e;await a.db.updateTable("users").set({onboardingCompleted:!0,onboardingCompletedAt:new Date,...r}).where("auth0Id","=",t).execute()}async function l(e,t){Object.keys(t).length&&await a.db.updateTable("users").set({...t}).where("id","=",e).execute()}a=(n.then?(await n)():n)[0],s()}catch(e){s(e)}})},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30478:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>o,routeModule:()=>d,serverHooks:()=>w,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>l});var a=r(96559),n=r(48088),i=r(37719),c=r(85935),u=e([c]);c=(u.then?(await u)():u)[0];let d=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/pets/[petId]/route",pathname:"/api/pets/[petId]",filename:"route",bundlePath:"app/api/pets/[petId]/route"},resolvedPagePath:"/home/marty/turing/4-module/4-sprint/match4paws/src/app/api/pets/[petId]/route.ts",nextConfigOutput:"",userland:c}),{workAsyncStorage:p,workUnitAsyncStorage:l,serverHooks:w}=d;function o(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:l})}s()}catch(e){s(e)}})},32496:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{$y:()=>d,Ux:()=>u,WX:()=>o,l:()=>p});var a=r(32190),n=r(93109),i=r(24476),c=e([i]);async function u(e){let t=await n.J.getSession();if(!t?.user?.sub)return null;let r=await (0,i.iU)(t.user.sub);return r?.id??null}function o(e,t){return a.NextResponse.json({error:e},{status:t})}function d(e){return a.NextResponse.json({success:!0,...e})}async function p(e,t){try{let r=await e.json();for(let e of t)if(!r[e])return o(`Missing required field: ${String(e)}`,400);return r}catch(e){return o("Invalid JSON body",400)}}i=(c.then?(await c)():c)[0],s()}catch(e){s(e)}})},33873:e=>{"use strict";e.exports=require("path")},37067:e=>{"use strict";e.exports=require("node:http")},40916:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{HP:()=>y,IW:()=>u,JD:()=>p,R7:()=>x,US:()=>l,UT:()=>m,_L:()=>w,fz:()=>d,gm:()=>h,or:()=>o,zq:()=>c});var a=r(5069),n=r(15400),i=e([a]);async function c(e,t,r){let s=a.db.selectFrom("pets");e.type&&(s=s.where("pets.type","=",e.type)),e.gender&&(s=s.where("pets.gender","=",e.gender)),e.size&&(s=s.where("pets.size","=",e.size)),e.age&&(s=s.where("pets.ageGroup","=",e.age));let{count:i}=await s.clearSelect().select(e=>e.fn.countAll().as("count")).executeTakeFirstOrThrow();return{pets:await s.leftJoin("petImages as pi",e=>e.onRef("pi.petId","=","pets.id").on("pi.orderIdx","=",0)).offset((t-1)*r).limit(r).orderBy("pets.createdAt","desc").select(["pets.id","pets.name","pets.breed","pets.size","pets.ageGroup",(0,n.l)`pi.url`.as("imageUrl")]).execute(),totalCount:Number(i)}}async function u(e,t){let r=await a.db.selectFrom("pets").selectAll().where("id","=",e).where("ownerId","=",t).executeTakeFirst();if(!r)return null;let s=await a.db.selectFrom("petImages").select(["url","orderIdx"]).where("petId","=",e).orderBy("orderIdx","asc").execute();return{...r,images:s}}async function o(e){return await a.db.selectFrom("pets").where("pets.id","=",e).select(["id","name","ageGroup","breed","size","gender","description","ownerId"]).executeTakeFirst()||null}async function d(e){return a.db.selectFrom("petImages").where("petId","=",e).orderBy("orderIdx").select(["url"]).execute()}async function p(e){return await a.db.selectFrom("users").where("id","=",e).select(["name"]).executeTakeFirst()||null}async function l(e,t){return!!await a.db.selectFrom("favourites").select("petId").where("petId","=",e).where("userId","=",t).executeTakeFirst()}async function w(e,t){return(await a.db.insertInto("pets").values({ownerId:e,...t}).returning("id").executeTakeFirstOrThrow()).id}async function h(e){let t=await a.db.selectFrom("pets").select(["pets.id","pets.name","pets.type","pets.breed","pets.gender","pets.size","pets.ageGroup","pets.description","pets.status","pets.createdAt","pets.updatedAt"]).where("pets.ownerId","=",e).orderBy("pets.createdAt","desc").execute();return await Promise.all(t.map(async e=>({...e,images:await a.db.selectFrom("petImages").select(["url","orderIdx"]).where("petId","=",e.id).orderBy("orderIdx","asc").execute()})))}async function y(e,t,r){Object.keys(r).length&&await a.db.updateTable("pets").set({...r,updatedAt:new Date}).where("id","=",e).where("ownerId","=",t).execute()}async function x(e,t){await a.db.deleteFrom("petImages").where("petId","=",e).execute(),await a.db.deleteFrom("pets").where("id","=",e).where("ownerId","=",t).execute()}async function m(e,t){await a.db.deleteFrom("petImages").where("petId","=",e).execute(),t.length&&await a.db.insertInto("petImages").values(t.map((t,r)=>({petId:e,url:t,orderIdx:r}))).execute()}a=(i.then?(await i)():i)[0],s()}catch(e){s(e)}})},44708:e=>{"use strict";e.exports=require("node:https")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},85935:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{DELETE:()=>l,GET:()=>o,PATCH:()=>p,PUT:()=>d});var a=r(32496),n=r(40916),i=e([a,n]);async function c(e){let t=await (0,a.Ux)();if(!t)throw Error("401");return t}async function u(e,t,r){let{imageUrls:s=[],name:a,type:i,breed:c,gender:u,size:o,ageGroup:d,description:p,status:l}=r,w={...void 0!==a&&{name:a},...void 0!==i&&{type:i},...void 0!==c&&{breed:c},...void 0!==u&&{gender:u},...void 0!==o&&{size:o},...void 0!==d&&{ageGroup:d},...void 0!==p&&{description:p},...void 0!==l&&{status:l}};Object.keys(w).length&&await (0,n.HP)(e,t,w),await (0,n.UT)(e,s)}async function o(e,{params:t}){try{let r=await c(e),s=await t,i=await (0,n.IW)(s.petId,r);if(!i)return(0,a.WX)("Pet not found",404);return(0,a.$y)({pet:i})}catch(e){return"401"===e.message?(0,a.WX)("Unauthorized",401):(0,a.WX)("Internal server error",500)}}async function d(e,t){return p(e,t)}async function p(e,{params:t}){try{let r=await c(e),s=await e.json(),n=await t;return await u(n.petId,r,s),(0,a.$y)()}catch(e){return"401"===e.message?(0,a.WX)("Unauthorized",401):(0,a.WX)("Internal server error",500)}}async function l(e,{params:t}){try{let r=await c(e),s=await t;return await (0,n.R7)(s.petId,r),(0,a.$y)()}catch(e){return"401"===e.message?(0,a.WX)("Unauthorized",401):(0,a.WX)("Internal server error",500)}}[a,n]=i.then?(await i)():i,s()}catch(e){s(e)}})},93109:(e,t,r)=>{"use strict";r.d(t,{J:()=>s});let s=new(r(94420)).OF({domain:process.env.AUTH0_DOMAIN,clientId:process.env.AUTH0_CLIENT_ID,clientSecret:process.env.AUTH0_CLIENT_SECRET,secret:process.env.AUTH0_SECRET,appBaseUrl:process.env.APP_BASE_URL})},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,420,326],()=>r(30478));module.exports=s})();