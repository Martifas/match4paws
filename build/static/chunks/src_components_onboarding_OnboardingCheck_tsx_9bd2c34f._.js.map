{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/mgrumadas/projects/match4paws/src/components/onboarding/OnboardingCheck.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRouter } from \"next/navigation\";\nimport { useEffect, useState, useCallback } from \"react\";\n\nexport default function OnboardingCheck({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const router = useRouter();\n  const [isReady, setIsReady] = useState(false);\n\n  const checkOnboardingStatus = useCallback(\n    async (userId: string) => {\n      try {\n        console.log(\"[OnboardingCheck] Checking or creating user:\", userId);\n\n        await fetch(\"/api/users/create\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ userId }),\n        });\n\n        const response = await fetch(\"/api/check-onboarding\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ userId }),\n        });\n\n        const data = await response.json();\n\n        if (!data.onboardingCompleted) {\n          console.log(\"[OnboardingCheck] Redirecting to /onboarding\");\n          router.push(\"/onboarding\");\n        } else {\n          console.log(\"[OnboardingCheck] Onboarding complete\");\n          setIsReady(true);\n        }\n      } catch (error) {\n        console.error(\"[OnboardingCheck] Failed:\", error);\n        setIsReady(true); // allow fallback render\n      }\n    },\n    [router]\n  );\n\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const response = await fetch(\"/auth/profile\");\n        const contentType = response.headers.get(\"content-type\");\n\n        if (!contentType?.includes(\"application/json\")) {\n          console.warn(\"[OnboardingCheck] Invalid content type:\", contentType);\n          setIsReady(true);\n          return;\n        }\n\n        if (response.ok) {\n          const user = await response.json();\n          console.log(\"[OnboardingCheck] User loaded:\", user?.sub);\n\n          if (user?.sub) {\n            checkOnboardingStatus(user.sub);\n          } else {\n            setIsReady(true);\n          }\n        } else {\n          console.warn(\"[OnboardingCheck] Failed to fetch user\");\n          setIsReady(true);\n        }\n      } catch (err) {\n        console.error(\"[OnboardingCheck] Error fetching user:\", err);\n        setIsReady(true);\n      }\n    };\n\n    fetchUser();\n  }, [checkOnboardingStatus]);\n\n  if (!isReady) return <div>Not working!</div>;\n\n  return <>{children}</>;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS,gBAAgB,EACtC,QAAQ,EAGT;;IACC,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,MAAM,wBAAwB,CAAA,GAAA,6JAAA,CAAA,cAAW,AAAD;8DACtC,OAAO;YACL,IAAI;gBACF,QAAQ,GAAG,CAAC,gDAAgD;gBAE5D,MAAM,MAAM,qBAAqB;oBAC/B,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE;oBAAO;gBAChC;gBAEA,MAAM,WAAW,MAAM,MAAM,yBAAyB;oBACpD,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE;oBAAO;gBAChC;gBAEA,MAAM,OAAO,MAAM,SAAS,IAAI;gBAEhC,IAAI,CAAC,KAAK,mBAAmB,EAAE;oBAC7B,QAAQ,GAAG,CAAC;oBACZ,OAAO,IAAI,CAAC;gBACd,OAAO;oBACL,QAAQ,GAAG,CAAC;oBACZ,WAAW;gBACb;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,6BAA6B;gBAC3C,WAAW,OAAO,wBAAwB;YAC5C;QACF;6DACA;QAAC;KAAO;IAGV,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;qCAAE;YACR,MAAM;uDAAY;oBAChB,IAAI;wBACF,MAAM,WAAW,MAAM,MAAM;wBAC7B,MAAM,cAAc,SAAS,OAAO,CAAC,GAAG,CAAC;wBAEzC,IAAI,CAAC,aAAa,SAAS,qBAAqB;4BAC9C,QAAQ,IAAI,CAAC,2CAA2C;4BACxD,WAAW;4BACX;wBACF;wBAEA,IAAI,SAAS,EAAE,EAAE;4BACf,MAAM,OAAO,MAAM,SAAS,IAAI;4BAChC,QAAQ,GAAG,CAAC,kCAAkC,MAAM;4BAEpD,IAAI,MAAM,KAAK;gCACb,sBAAsB,KAAK,GAAG;4BAChC,OAAO;gCACL,WAAW;4BACb;wBACF,OAAO;4BACL,QAAQ,IAAI,CAAC;4BACb,WAAW;wBACb;oBACF,EAAE,OAAO,KAAK;wBACZ,QAAQ,KAAK,CAAC,0CAA0C;wBACxD,WAAW;oBACb;gBACF;;YAEA;QACF;oCAAG;QAAC;KAAsB;IAE1B,IAAI,CAAC,SAAS,qBAAO,6LAAC;kBAAI;;;;;;IAE1B,qBAAO;kBAAG;;AACZ;GA/EwB;;QAKP,qIAAA,CAAA,YAAS;;;KALF","debugId":null}}]
}