(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7475],{1078:(e,t,r)=>{"use strict";r.d(t,{default:()=>o});var a=r(5155),l=r(5695),s=r(8464),n=r(2596);function o(e){let{to:t,hidden:r,className:o,onClick:i,smartNavigation:c=!1,...d}=e,u=(0,l.useRouter)(),h=(0,l.usePathname)();return r?null:(0,a.jsx)("button",{type:"button",onClick:()=>{i?i():t?u.push(t):c&&(document.referrer.includes("/favorites")||h.startsWith("/pet/"))?u.push("/favorites?refresh="+Date.now()):u.back()},className:(0,n.A)("text-[#ed9426] hover:text-orange-300 hover:scale-110 font-bold",o),...d,children:(0,a.jsx)(s.A,{fontSize:"large"})})}},1968:(e,t,r)=>{Promise.resolve().then(r.bind(r,5527))},2663:(e,t,r)=>{"use strict";r.d(t,{A:()=>j});var a=r(2115),l=r(2596),s=r(7472),n=r(5955),o=r(680),i=r(186),c=r(7515),d=r(5155);let u=(0,c.A)((0,d.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");var h=r(5170),f=r(870);function m(e){return(0,f.Ay)("MuiAvatar",e)}(0,h.A)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var p=r(7798);let x=e=>{let{classes:t,variant:r,colorDefault:a}=e;return(0,s.A)({root:["root",r,a&&"colorDefault"],img:["img"],fallback:["fallback"]},m,t)},v=(0,n.Ay)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,t[r.variant],r.colorDefault&&t.colorDefault]}})((0,o.A)(e=>{let{theme:t}=e;return{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:{color:(t.vars||t).palette.background.default,...t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:{backgroundColor:t.palette.grey[400],...t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})}}}]}})),g=(0,n.Ay)("img",{name:"MuiAvatar",slot:"Img"})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),y=(0,n.Ay)(u,{name:"MuiAvatar",slot:"Fallback"})({width:"75%",height:"75%"}),j=a.forwardRef(function(e,t){let r=(0,i.b)({props:e,name:"MuiAvatar"}),{alt:s,children:n,className:o,component:c="div",slots:u={},slotProps:h={},imgProps:f,sizes:m,src:j,srcSet:b,variant:A="circular",...w}=r,k=null,N={...r,component:c,variant:A},C=function(e){let{crossOrigin:t,referrerPolicy:r,src:l,srcSet:s}=e,[n,o]=a.useState(!1);return a.useEffect(()=>{if(!l&&!s)return;o(!1);let e=!0,a=new Image;return a.onload=()=>{e&&o("loaded")},a.onerror=()=>{e&&o("error")},a.crossOrigin=t,a.referrerPolicy=r,a.src=l,s&&(a.srcset=s),()=>{e=!1}},[t,r,l,s]),n}({...f,..."function"==typeof h.img?h.img(N):h.img,src:j,srcSet:b}),S=j||b,D=S&&"error"!==C;N.colorDefault=!D,delete N.ownerState;let P=x(N),[R,E]=(0,p.A)("root",{ref:t,className:(0,l.A)(P.root,o),elementType:v,externalForwardedProps:{slots:u,slotProps:h,component:c,...w},ownerState:N}),[I,F]=(0,p.A)("img",{className:P.img,elementType:g,externalForwardedProps:{slots:u,slotProps:{img:{...f,...h.img}}},additionalProps:{alt:s,src:j,srcSet:b,sizes:m},ownerState:N}),[M,z]=(0,p.A)("fallback",{className:P.fallback,elementType:y,externalForwardedProps:{slots:u,slotProps:h},shouldForwardComponentProp:!0,ownerState:N});return k=D?(0,d.jsx)(I,{...F}):n||0===n?n:S&&s?s[0]:(0,d.jsx)(M,{...z}),(0,d.jsx)(R,{...E,children:k})})},5527:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var a=r(5155),l=r(2115),s=r(5695),n=r(6278),o=r(4492),i=r(9927),c=r(1977),d=r(8534),u=r(3127),h=r(2663),f=r(9505),m=r(6915),p=r(1078),x=r(7601);let v=e=>{let{open:t,onClose:r,onConfirm:l}=e;return(0,a.jsxs)(n.A,{open:t,onClose:r,PaperProps:{sx:{borderRadius:2,minWidth:300}},children:[(0,a.jsx)(o.A,{sx:{color:"error.main",fontWeight:"bold"},children:"\uD83D\uDDD1️ Delete Conversation?"}),(0,a.jsx)(i.A,{children:"This action cannot be undone. All messages in this conversation will be permanently deleted."}),(0,a.jsxs)(c.A,{sx:{p:2,gap:1},children:[(0,a.jsx)(d.A,{onClick:r,variant:"outlined",color:"inherit",children:"Cancel"}),(0,a.jsx)(d.A,{onClick:l,variant:"contained",color:"error",sx:{fontWeight:"bold"},children:"Delete Forever"})]})]})};function g(e){let{conversationId:t}=e,r=(0,s.useRouter)(),{user:n,isLoading:o}=(0,x.A)(),{messages:i,send:c,loading:d,error:g}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e4,[r,a]=(0,l.useState)([]),[s,n]=(0,l.useState)(!!e),[o,i]=(0,l.useState)(null),c=(0,l.useRef)(null),d=(0,l.useCallback)(async()=>{if(e)try{let t=new URL("/api/messages",location.origin);t.searchParams.set("conversationId",e),c.current&&t.searchParams.set("after",c.current);let r=await fetch(t.toString()),{messages:l=[]}=await r.json();l.length&&(a(e=>{let t=new Set(e.map(e=>e.id)),r=l.filter(e=>!t.has(e.id));return r.length?[...e,...r]:e}),c.current=l.at(-1).sent_at),i(null)}catch(e){i("Failed to load messages")}finally{n(!1)}},[e]);return(0,l.useEffect)(()=>{if(!e)return;a([]),c.current=null,n(!0),d();let r=setInterval(d,t);return()=>clearInterval(r)},[e,d,t]),{messages:r,loading:s,error:o,send:(0,l.useCallback)(async(t,r,l)=>{let s={id:crypto.randomUUID(),conversationId:e,senderId:r,senderName:null!=l?l:"You",body:t,sentAt:new Date().toISOString(),readAt:null};a(e=>[...e,s]);try{let r=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:e,body:t})}),{message:l}=await r.json();a(e=>e.map(e=>e.id===s.id?l:e)),c.current=l.sentAt}catch(e){throw a(e=>e.filter(e=>e.id!==s.id)),Error("send-failed")}},[e]),refresh:d}}(t),[y,j]=(0,l.useState)(""),[b,A]=(0,l.useState)(!1),w=(0,l.useRef)(null);(0,l.useEffect)(()=>{var e;null==(e=w.current)||e.scrollIntoView({behavior:"smooth"})},[i]);let k=async()=>{A(!1),await fetch("/api/conversations/".concat(t),{method:"DELETE"}),r.push("/messages")},N=async()=>{var e;y.trim()&&n&&(await c(y.trim(),n.id,null!=(e=n.name)?e:"You"),j(""))};return o||d?(0,a.jsx)("p",{className:"text-center py-10",children:"Loading…"}):t?(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-white",children:[(0,a.jsx)(m.default,{left:(0,a.jsx)(p.default,{smartNavigation:!0}),center:(0,a.jsx)("h1",{className:"text-lg font-semibold",children:"Messages"}),right:(0,a.jsx)(u.A,{onClick:()=>{A(!0)},edge:"end",size:"small",children:(0,a.jsx)(f.A,{fontSize:"small"})})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[g&&(0,a.jsx)("p",{className:"text-red-500",children:g}),i.map(e=>{var t,r,l;let s=e.senderId===n.id,o=null!=(l=null==(t=(s?n.name:null!=(r=e.senderName)?r:"U")[0])?void 0:t.toUpperCase())?l:"U";return(0,a.jsxs)("div",{className:"flex items-start ".concat(s?"justify-end":"justify-start"),children:[!s&&(0,a.jsx)(h.A,{sx:{bgcolor:"#ed9426",width:32,height:32,mr:2},children:o}),(0,a.jsx)("div",{className:"max-w-xs p-3 rounded-lg ".concat(s?"bg-blue-100 text-gray-900":"bg-green-100 text-gray-800"),children:e.body}),s&&(0,a.jsx)(h.A,{sx:{bgcolor:"#ed9426",width:32,height:32,ml:2},children:o})]},e.id)}),(0,a.jsx)("div",{ref:w})]}),(0,a.jsxs)("div",{className:"p-3 border-t pb-15 flex gap-2",children:[(0,a.jsx)("input",{className:"flex-1 border rounded px-3 py-2",value:y,onChange:e=>j(e.target.value),onKeyDown:e=>"Enter"===e.key&&N(),placeholder:"Type a message…"}),(0,a.jsx)("button",{className:"bg-orange-500 text-white rounded px-4 disabled:opacity-50",onClick:N,disabled:!y.trim(),children:"Send"})]}),(0,a.jsx)(v,{open:b,onClose:()=>A(!1),onConfirm:k})]}):(0,a.jsx)("p",{className:"text-center py-10 text-gray-500",children:"Select a conversation to start chatting."})}function y(e){let{params:t}=e,{id:r}=(0,l.use)(t);return(0,a.jsx)(g,{conversationId:r})}},6768:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>o});var a=r(5155),l=r(2115);let s=(0,l.createContext)(null),n=()=>(0,l.useContext)(s);function o(e){let{initialUser:t,children:r}=e;return(0,a.jsx)(s.Provider,{value:t,children:r})}},6915:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var a=r(5155);function l(e){let{left:t,center:r,right:l,children:s}=e;return(0,a.jsx)("header",{className:"w-full max-w-md mx-auto  md:max-w-xl py-2 flex items-center justify-between gap-4",children:s||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:t}),(0,a.jsx)("div",{className:"flex-1 text-center overflow-hidden",children:r}),(0,a.jsx)("div",{className:"flex-shrink-0",children:l})]})})}r(2115)},7601:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(6768),l=r(2115);function s(){let e=(0,a.A)(),[t,r]=(0,l.useState)(null),[s,n]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async()=>{if(!(null==e?void 0:e.id))return n(!1);try{let e=await fetch("/api/user/profile");if(e.ok){let t=await e.json();r(t.user)}}catch(e){console.error("Error fetching user data:",e)}finally{n(!1)}})()},[null==e?void 0:e.id]),{user:t,isLoading:s}}},8464:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(7515),l=r(5155);let s=(0,a.A)((0,l.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},9505:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(7515),l=r(5155);let s=(0,a.A)((0,l.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")}},e=>{var t=t=>e(e.s=t);e.O(0,[6727,5978,8702,9985,3127,8813,4904,8441,1684,7358],()=>t(1968)),_N_E=e.O()}]);